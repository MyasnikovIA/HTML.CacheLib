<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25" zv="Cache for Windows (x86-64) 2017.1 (Build 792)" ts="2017-11-17 16:31:18">
<Class name="User.CallTest2">
<Super>%CSP.Page</Super>
<TimeChanged>64604,59389.437362</TimeChanged>
<TimeCreated>64604,50688.854413</TimeCreated>

<Method name="OnPage">
<ClassMethod>1</ClassMethod>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	&html<
	   <script src='HTML.CacheLib.cls'></script> 
	   <pre>
	    <div id='status'></div>
	    <div id='demo'></div>
	   </pre>
	   <script language="JavaScript">   
	      
         var idJob;
         /// опревить команду на уничтожение процесса
         KillProc=function(){
	         killRunJob(idJob);
         }
  
         /// Запустить процесс
         StartProc=function(){
             idJob=#call(..Test([resFun,ProgressFun,2000,"MyNewReport"],"dddddd",4444,"sdgsdfgsdf"))#	;
             document.getElementById("demo").innerHTML =idJob;
             document.getElementById("status").innerHTML ='Новый запуск процесса';
         }
  
         
         /// Функция срабатывает по окончанию работы процесса 
         resFun=function(obj){
           document.getElementById("demo").innerHTML='Wor End'+JSON.stringify(obj);
           document.getElementById("status").innerHTML ='Работа процесса окончена';
         }
         
         /// функция прогрессбара
         var ind3=0
         ProgressFun=function(obj){
	          ind3++;
              // document.getElementById("demo").innerHTML=ind3+'Wor progress:'+JSON.stringify(obj);
              document.getElementById("demo").innerHTML ='<br>Счетчик итераций JS : '+ind3;
              document.getElementById("demo").innerHTML+='<br>Wor progress:'+ obj.info;
              document.getElementById("demo").innerHTML+='<br>job:'+ obj.JOB;
              document.getElementById("demo").innerHTML+='<br>ajob:'+ obj.aJOB;
              document.getElementById("demo").innerHTML+='<br>eval:'+ obj.eval;
              if (obj.eval!==undefined){
	              if (obj.eval.length>0){
                      eval(obj.eval)
                      obj.eval='';
	              }
              }
         }
         BeginFunIfRestoreJob=function(){
             document.getElementById("status").innerHTML ='Работа процесса востановлена';
         }
         
         /// Востановление ранее запущеного процесса
         RestoreRunJob(resFun,ProgressFun,BeginFunIfRestoreJob,2000,"MyNewReport")
      </script> 
      <button onclick="StartProc()">StartProc</button>
      <button onclick="KillProc()">KillProc</button>
	>
	Quit $$$OK
]]></Implementation>
</Method>

<Method name="Test">
<ClassMethod>1</ClassMethod>
<FormalSpec>arg1,arg2,arg3</FormalSpec>
<Implementation><![CDATA[
	; %runjob - имя глобала , через который происходит обмен Web морды и Cache` процесса
    for a=1:1:1000 {   
	  h 1
      s @%runjob@("info")= arg1_" Счетчик внутри процесса "_a
      s @%runjob@("eval")= "alert("_$job_")"
    }
	w $zdt($h)
	s @%runjob@("OK")=1 ; сообщаем Web морде о том, что процесс закончен корректно
	q
]]></Implementation>
</Method>
</Class>
</Export>
